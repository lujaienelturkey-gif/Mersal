<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ø¨Ø¹ØªÙ‡Ø§ Ù„Ù…Ù‡Ø¬Ø©</title>
  <style>
    :root{
      --blue:#0b66ff;
      --light:#f6fbff;
      --green:#25c26b;
      --card-shadow: 0 6px 18px rgba(11,102,255,0.08);
    }
    html,body{height:100%;margin:0;font-family:Arial, sans-serif;background:var(--light);color:#0b2447}
    header{text-align:center;padding:20px}
    .logo{font-size:40px;font-weight:700;color:var(--blue)}
    .subtitle{font-size:16px;color:#205aa8;font-family:cursive;display:flex;align-items:center;justify-content:center;gap:8px}

    main{padding:20px;max-width:600px;margin:auto}
    .card{background:white;border-radius:14px;padding:18px;box-shadow:var(--card-shadow);margin-bottom:18px}

    .btn{border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--blue);color:white}
    .green-box{width:32px;height:32px;border-radius:6px;border:2px solid #ccc;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px}
    .green-box.active{background:var(--green);color:#fff;border-color:var(--green)}
    .download-btn{margin-right:10px;color:var(--blue);cursor:pointer;border:none;background:none;text-decoration:underline;font-size:14px}

    .track{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #eee}
    .track audio{max-width:200px}
    #welcomeOverlay{position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:1000}
    #welcomeBox{max-width:500px;text-align:center;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.1);background:white}
    #welcomeBox p{margin-bottom:16px}
    #welcomeBox button{padding:10px 14px;border:0;background:var(--blue);color:#fff;border-radius:10px;cursor:pointer;font-weight:bold}
    .pin-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.05);display:flex;align-items:center;justify-content:center;z-index:2000}
    .pin-box{background:white;padding:26px;border-radius:12px;box-shadow:0 16px 40px rgba(11,102,255,0.12);max-width:420px;width:94%;text-align:center}
    .pin-input{font-size:20px;padding:12px;border-radius:10px;border:1px solid #e6eefc;width:100%;box-sizing:border-box;text-align:center}
    .pin-submit{margin-top:12px;padding:10px 14px;border-radius:10px;border:0;background:var(--blue);color:white;font-weight:700;cursor:pointer}
    .pin-error{color:#c0392b;margin-top:10px;display:none}
  </style>
</head>
<body>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙƒÙˆØ¯ -->
  <div class="pin-overlay" id="pinOverlay">
    <div class="pin-box">
      <h2>Ù‡Ø§ÙŠ ØªØ§Ù…Ø± ğŸ˜‚â¤ï¸</h2>
      <p>Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ÙŠØ§ ØªØ§Ù…Ø±</p>
      <input id="pinInput" class="pin-input" inputmode="numeric" maxlength="6" placeholder="PIN">
      <button id="pinSubmit" class="pin-submit">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ†</button>
      <div id="pinError" class="pin-error">Ø§Ù„ÙƒÙˆØ¯ Ù…Ø´ ØµØ­</div>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
  <div id="welcomeOverlay" style="display:none">
    <div id="welcomeBox">
      <p>Ø¨Ù…Ø§ Ø¥Ù† Ù…ÙÙŠØ´ ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ†Ø§ ØºÙŠØ± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù…Ø±Ø³Ø§Ù„ Ù Ø§Ù†Ø§ Ø¹Ù…Ù„Øª Ù…Ø±Ø³Ø§Ù„ Ù…Ø­Ø¯Ø´ ÙŠØ´ÙˆÙÙ‡ ØºÙŠØ±ÙŠ Ø§Ù†Ø§ ÙˆØ§Ù†Øª , Ù…Ø´ Ù‡Ù†ØªÙƒÙ„Ù… Ø¨Ø³ ØªÙ‚Ø¯Ø± ØªØ¨Ø¹ØªÙ„ÙŠ Ø£ØºÙ†ÙŠØ© Ø£Ùˆ ÙÙˆÙŠØ³ Ù†ÙˆØª .. Ùˆ Ø±Ø¨Ù†Ø§ ÙŠØ®Ù„ÙŠÙƒ Ù„ÙŠÙ†Ø§ ÙŠØ§ Ø¨Ø§Ø´Ø§ â¤ï¸ğŸ˜‚</p>
      <button id="enterBtn">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ†</button>
    </div>
  </div>

  <header>
    <div class="logo">ğŸµ</div>
    <div class="subtitle"> ğŸ˜‚â¤ï¸Ø§Ø¨Ø¹ØªÙ‡Ø§ Ù„Ù…Ù‡Ø¬Ø© </div>
  </header>

  <main>
    <section class="card">
      <h3>Ø§Ø¨Ø¹Øª Ú¤ÙˆÙŠØ³ Ù†ÙˆØª Ø£Ùˆ Ø£ØºÙ†ÙŠØ©</h3>
      <input type="file" id="fileInput" accept="audio/*">
      <button class="btn btn-primary" id="uploadBtn">Upload</button>
      <div id="tracksList"></div>
    </section>
  </main>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    const SUPABASE_URL = "https://esdsowghlkzvhtciptzw.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzZHNvd2dobGt6dmh0Y2lwdHp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3OTUyMDcsImV4cCI6MjA3NDM3MTIwN30.UbcxM3aPtxNclA5G865eFQrKbqR7JaR6vWfoc68INic"

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    const bucketName = "tracks"


    const fileInput = document.getElementById('fileInput')
    const uploadBtn = document.getElementById('uploadBtn')
    const tracksList = document.getElementById('tracksList')

    async function loadTracks(){
      const { data, error } = await supabase.storage.from(bucketName).list()
      tracksList.innerHTML = ""
      if (error) {
        console.error(error)
        return
      }
      for(const file of data){
        const { data: urlData } = supabase.storage.from(bucketName).getPublicUrl(file.name)
        const url = urlData.publicUrl
        const trackDiv = document.createElement('div')
        trackDiv.className = 'track'
        trackDiv.innerHTML = `
          <audio controls src="${url}"></audio>
          <div style="display:flex;align-items:center">
            <button class="download-btn" onclick="window.open('${url}')">Ù†Ø²Ù„Ù†ÙŠ</button>
            <div class="green-box"></div>
          </div>
        `
        const box = trackDiv.querySelector('.green-box')
        box.addEventListener('click', ()=>{
          box.classList.toggle('active')
          box.innerHTML = box.classList.contains('active') ? 'âœ“' : ''
        })
        tracksList.appendChild(trackDiv)
      }
    }

    uploadBtn.addEventListener('click', async ()=>{
      const file = fileInput.files[0]
      if(!file) return
      const filePath = `${Date.now()}_${file.name}`
      const { error } = await supabase.storage.from(bucketName).upload(filePath, file)
      if(error){
        alert("Error uploading: " + error.message)
      } else {
        await loadTracks()
      }
    })


    loadTracks()

    // PIN logic
    const PIN = "10326"
    const pinOverlay = document.getElementById('pinOverlay')
    const pinInput = document.getElementById('pinInput')
    const pinSubmit = document.getElementById('pinSubmit')
    const pinError = document.getElementById('pinError')
    const welcomeOverlay = document.getElementById('welcomeOverlay')
    const enterBtn = document.getElementById('enterBtn')

    pinSubmit.addEventListener('click', ()=>{
      if(pinInput.value.trim() === PIN){
        pinOverlay.style.display="none"
        welcomeOverlay.style.display="flex"
      } else {
        pinError.style.display="block"
      }
    })

    enterBtn.addEventListener('click', ()=>{
      welcomeOverlay.style.display="none"
    })
  </script>
</body>
</html>
