<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ø¨Ø¹ØªÙ‡Ø§ Ù„Ù…Ù‡Ø¬Ø©</title>
<style>
:root{
  --blue:#0b66ff;
  --light:#f6fbff;
  --green:#25c26b;
  --card-shadow: 0 6px 18px rgba(11,102,255,0.08);
}
html,body{height:100%;margin:0;font-family:Arial,"Noto Naskh Arabic",sans-serif;background:var(--light);color:#0b2447}
header{background:white;padding:20px;text-align:center}
header .logo{font-size:36px;font-family:'Comic Sans MS', cursive;color:var(--blue)}
header .subtitle{font-family:'Comic Sans MS',cursive;font-size:20px;color:var(--blue)}
main{padding:28px;max-width:980px;margin:20px auto}
.card{background:white;border-radius:14px;padding:18px;box-shadow:var(--card-shadow);margin-bottom:18px}
.controls{display:flex;gap:12px;flex-wrap:wrap}
.btn{border:0;padding:12px 14px;border-radius:10px;cursor:pointer;font-weight:600}
.btn-primary{background:var(--blue);color:white}
.btn-outline{background:transparent;border:1px solid rgba(11,102,255,0.12);color:var(--blue)}
#recordBtn.recording{background:#ff5252}
#recordStatus{font-weight:700;margin-right:6px}
.dropzone{margin-top:14px;border:2px dashed rgba(11,102,255,0.12);padding:18px;border-radius:12px;text-align:center;color:#1f4f9a}
input[type=file]{display:none}
.list{margin-top:16px}
.track{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(11,102,255,0.04)}
.track + .track{margin-top:10px}
.track-info{flex:1}
.track-title{font-weight:700}
.track-meta{font-size:12px;color:#6a86b2}
.green-box{width:44px;height:44px;border-radius:8px;background:transparent;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;cursor:pointer;box-shadow:0 6px 14px rgba(37,194,107,0.18);transition:all 0.2s}
.green-box.selected{background:var(--green);content:'âœ“';color:white;transform:scale(1)}
footer{max-width:980px;margin:10px auto;color:#4b6fa3;text-align:center;font-size:13px}
.pin-overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(11,102,255,0.07),rgba(11,102,255,0.12));display:flex;align-items:center;justify-content:center;z-index:9999}
.pin-box{background:white;padding:26px;border-radius:12px;box-shadow:0 16px 40px rgba(11,102,255,0.12);max-width:420px;width:94%;text-align:center}
.pin-box h2{margin:0 0 8px 0}
.pin-box p{margin:0 0 18px 0;color:#2b5aa8}
.pin-input{font-size:20px;padding:12px;border-radius:10px;border:1px solid #e6eefc;width:100%;box-sizing:border-box;text-align:center}
.pin-submit{margin-top:12px;padding:10px 14px;border-radius:10px;border:0;background:var(--blue);color:white;font-weight:700;cursor:pointer}
.pin-error{color:#c0392b;margin-top:10px;display:none}
.message-overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(11,102,255,0.07),rgba(11,102,255,0.12));display:flex;align-items:center;justify-content:center;z-index:9999;display:none}
.message-box{background:white;padding:26px;border-radius:12px;box-shadow:0 16px 40px rgba(11,102,255,0.12);max-width:420px;width:94%;text-align:center}
.message-box p{margin-bottom:18px;color:#2b5aa8;font-size:14px}
.message-box button{padding:10px 14px;border-radius:10px;border:0;background:var(--blue);color:white;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="pin-overlay" id="pinOverlay" aria-hidden="false">
  <div class="pin-box" role="dialog" aria-labelledby="pinTitle">
    <h2 id="pinTitle">Ù‡Ø§ÙŠ ØªØ§Ù…Ø± ğŸ˜‚â¤ï¸</h2>
    <p>Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ÙŠØ§ Ø¹Ø³Ù„</p>
    <input id="pinInput" class="pin-input" inputmode="numeric" maxlength="6" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ PIN" aria-label="Ø±Ù…Ø² Ø§Ù„ÙŠÙ„Ø§ Ø£ÙˆØ¨Ø­">
    <button id="pinSubmit" class="pin-submit">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ†</button>
    <div id="pinError" class="pin-error">Ø§Ù„ÙƒÙˆØ¯ Ù…Ø´ ØµØ­ØŒ Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ.</div>
  </div>
</div>

<div class="message-overlay" id="messageOverlay">
  <div class="message-box">
    <p>Ø¨Ù…Ø§ Ø¥Ù† Ù…ÙÙŠØ´ ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ†Ø§ ØºÙŠØ± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù…Ø±Ø³Ø§Ù„ Ù Ø§Ù†Ø§ Ø¹Ù…Ù„Øª Ù…Ø±Ø³Ø§Ù„ Ù…Ø­Ø¯Ø´ ÙŠØ´ÙˆÙÙ‡ ØºÙŠØ±ÙŠ Ø§Ù†Ø§ ÙˆØ§Ù†Øª, Ù…Ø´ Ù‡Ù†ØªÙƒÙ„Ù… Ø¨Ø³ ØªÙ‚Ø¯Ø± ØªØ¨Ø¹ØªÙ„ÙŠ Ø£ØºÙ†ÙŠØ© Ø£Ùˆ ÙÙˆÙŠØ³ Ù†ÙˆØª .. Ùˆ Ø±Ø¨Ù†Ø§ ÙŠØ®Ù„ÙŠÙƒ Ù„ÙŠÙ†Ø§ ÙŠØ§ Ø¨Ø§Ø´Ø§</p>
    <button id="enterSiteBtn">ÙŠÙ„Ø§ Ø£ÙˆØ¨Ø­</button>
  </div>
</div>

<header>
  <div class="logo">Ø§Ø¨Ø¹ØªÙ‡Ø§ Ù„Ù…Ù‡Ø¬Ø© ğŸ˜‚â¤ï¸</div>
</header>

<main>
<section class="card">
  <h3>Ø­Ù…Ù„ Ø£ØºÙ†ÙŠØ© Ø£Ùˆ Ø§Ø¨Ø¹Øª Ú¤ÙˆÙŠØ³ Ù†ÙˆØª</h3>
  <div class="controls">
    <label class="btn btn-outline" for="fileInput">Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØªÙŠ</label>
    <input id="fileInput" type="file" accept="audio/*">
    <button id="recordBtn" class="btn btn-primary">Ø³Ø¬Ù„ Ú¤ÙˆÙŠØ³ Ù†ÙˆØª</button>
    <button id="stopBtn" class="btn btn-outline" disabled>Ø¥ÙŠÙ‚Ø§Ù</button>
    <div id="recordStatus" style="margin-left:12px;display:flex;align-items:center"></div>
  </div>
  <div class="dropzone" id="dropzone">Ø§Ø±ÙØ¹ Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· "Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØªÙŠ"</div>
  <div class="list card" id="tracksList" style="margin-top:18px">
    <h4 style="margin-top:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h4>
    <div id="tracksContainer"></div>
  </div>
</section>
</main>

<footer>
 <strong>ğŸ¦¦â¤ï¸</strong>
</footer>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://esdsowghlkzvhtciptzw.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzZHNvd2dobGt6dmh0Y2lwdHp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3OTUyMDcsImV4cCI6MjA3NDM3MTIwN30.UbcxM3aPtxNclA5G865eFQrKbqR7JaR6vWfoc68INic'

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

const pinInput = document.getElementById('pinInput')
const pinSubmit = document.getElementById('pinSubmit')
const pinOverlay = document.getElementById('pinOverlay')
const pinError = document.getElementById('pinError')
const messageOverlay = document.getElementById('messageOverlay')
const enterSiteBtn = document.getElementById('enterSiteBtn')

const PIN = '10326'

pinSubmit.addEventListener('click', ()=>{
  if(pinInput.value.trim() === PIN){
    pinOverlay.style.display = 'none'
    messageOverlay.style.display = 'flex'
  }else{
    pinError.style.display = 'block'
  }
})

enterSiteBtn.addEventListener('click', ()=>{
  messageOverlay.style.display = 'none'
})

const fileInput = document.getElementById('fileInput')
const dropzone = document.getElementById('dropzone')
const tracksContainer = document.getElementById('tracksContainer')
const recordBtn = document.getElementById('recordBtn')
const stopBtn = document.getElementById('stopBtn')
const recordStatus = document.getElementById('recordStatus')
let mediaRecorder = null
let chunks = []

async function addTrack(blob,name){
  const { data, error } = await supabase
    .storage.from('tracks')
    .upload(`${Date.now()}_${name}`, blob)
  if(error){alert('Error uploading:'+error.message);return}
  const { publicURL } = supabase.storage.from('tracks').getPublicUrl(`${Date.now()}_${name}`)
  const track = document.createElement('div')
  track.className='track'
  const info = document.createElement('div')
  info.className='track-info'
  const title = document.createElement('div')
  title.className='track-title'
  title.textContent=name
  const meta=document.createElement('div')
  meta.className='track-meta'
  const audio=document.createElement('audio')
  audio.controls=true
  audio.src=publicURL
  meta.appendChild(audio)
  const downloadBtn=document.createElement('button')
  downloadBtn.textContent='Ù†Ø²Ù„Ù†ÙŠ'
  downloadBtn.className='btn btn-outline'
  downloadBtn.addEventListener('click',()=>{window.open(publicURL)})
  const greenBox=document.createElement('div')
  greenBox.className='green-box'
  greenBox.addEventListener('click',()=>{
    greenBox.classList.toggle('selected')
  })
  track.appendChild(greenBox)
  track.appendChild(info)
  track.appendChild(downloadBtn)
  tracksContainer.prepend(track)
}

fileInput.addEventListener('change',(e)=>{
  const f=e.target.files[0]
  if(f) addTrack(f,f.name)
  fileInput.value=''
})

;['dragenter','dragover'].forEach(ev=>{
  dropzone.addEventListener(ev,(e)=>{e.preventDefault();dropzone.style.borderColor='rgba(11,102,255,0.4)'})
})
;['dragleave','drop'].forEach(ev=>{
  dropzone.addEventListener(ev,(e)=>{e.preventDefault();dropzone.style.borderColor='rgba(11,102,255,0.12)'})
})
dropzone.addEventListener('drop',(e)=>{
  const f=e.dataTransfer.files[0]
  if(f) addTrack(f,f.name)
})

recordBtn.addEventListener('click',async()=>{
  if(mediaRecorder && mediaRecorder.state==='recording') return
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true})
    mediaRecorder=new MediaRecorder(stream)
    chunks=[]
    mediaRecorder.ondataavailable=e=>chunks.push(e.data)
    mediaRecorder.onstart=()=>{
      recordBtn.classList.add('recording')
      recordBtn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...'
      stopBtn.disabled=false
      recordStatus.textContent='â— ØªØ³Ø¬ÙŠÙ„'
    }
    mediaRecorder.onstop=()=>{
      recordBtn.classList.remove('recording')
      recordBtn.textContent='Ø³Ø¬Ù„ Ú¤ÙˆÙŠØ³ Ù†ÙˆØª'
      stopBtn.disabled=true
      recordStatus.textContent=''
      const blob=new Blob(chunks,{type:'audio/webm'})
      addTrack(blob,'Ú¤ÙˆÙŠØ³ Ù†ÙˆØª - '+new Date().toLocaleString())
    }
    mediaRecorder.start()
  }catch(err){alert('Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø°Ù†.')}
})

stopBtn.addEventListener('click',()=>{if(mediaRecorder&&mediaRecorder.state==='recording')mediaRecorder.stop()})
</script>
</body>
</html>
