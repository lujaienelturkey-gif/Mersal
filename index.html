<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ø¨Ø¹ØªÙ‡Ø§ Ù„Ù…Ù‡Ø¬Ø©</title>
  <style>
    body{margin:0;font-family:Arial, sans-serif;background:#f6fbff}
    .btn{padding:10px 16px;border:0;border-radius:8px;cursor:pointer;font-weight:bold}
    .btn-primary{background:#0b66ff;color:#fff}
    .btn-outline{background:#fff;border:1px solid #0b66ff;color:#0b66ff}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.3);z-index:9999}
    .box{background:#fff;padding:20px;border-radius:10px;max-width:400px;text-align:center}
    .track{display:flex;align-items:center;gap:10px;margin:10px 0;padding:10px;border:1px solid #eee;border-radius:8px}
    .green-box{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:6px;background:#ddd;cursor:pointer}
    .green-box.selected{background:#25c26b;color:#fff;font-weight:bold}
  </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù€ PIN -->
<div class="overlay" id="pinOverlay">
  <div class="box">
    <h3>Ù‡Ø§ÙŠ ØªØ§Ù…Ø± ğŸ˜‚â¤ï¸</h3>
    <p>Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ÙŠØ§ Ø¹Ø³Ù„</p>
    <input id="pinInput" maxlength="6" style="padding:8px;text-align:center;font-size:18px">
    <div>
      <button class="btn btn-primary" id="pinSubmit">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ†</button>
    </div>
    <p id="pinError" style="color:red;display:none">Ø§Ù„ÙƒÙˆØ¯ Ù…Ø´ ØµØ­ØŒ Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ</p>
  </div>
</div>

<!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
<div class="overlay" id="messageOverlay" style="display:none">
  <div class="box">
    <p>Ø¨Ù…Ø§ Ø¥Ù† Ù…ÙÙŠØ´ ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ†Ø§ ØºÙŠØ± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù…Ø±Ø³Ø§Ù„ .. Ù Ø§Ù†Ø§ Ø¹Ù…Ù„Øª Ù…Ø±Ø³Ø§Ù„ Ù…Ø­Ø¯Ø´ ÙŠØ´ÙˆÙÙ‡ ØºÙŠØ±ÙŠ Ø§Ù†Ø§ ÙˆØ§Ù†Øª , Ù…Ø´ Ù‡Ù†ØªÙƒÙ„Ù… Ø¨Ø³ ØªÙ‚Ø¯Ø± ØªØ¨Ø¹ØªÙ„ÙŠ Ø£ØºÙ†ÙŠØ© Ø£Ùˆ ÙÙˆÙŠØ³ Ù†ÙˆØª .. Ùˆ Ø±Ø¨Ù†Ø§ ÙŠØ®Ù„ÙŠÙƒ Ù„ÙŠÙ†Ø§ ÙŠØ§ Ø¨Ø§Ø´Ø§</p>
    <button class="btn btn-primary" id="enterBtn">ÙŠÙ„Ø§ Ø£ÙˆØ¨Ø­</button>
  </div>
</div>

<main style="padding:20px;max-width:800px;margin:auto">
  <h2>ğŸ“¥ Ø§Ø±ÙØ¹ Ø£ØºÙ†ÙŠØ© Ø£Ùˆ Ø³Ø¬Ù„ Ú¤ÙˆÙŠØ³ Ù†ÙˆØª</h2>
  <input type="file" id="fileInput" accept="audio/*" style="margin:10px 0">
  <button class="btn btn-outline" id="recordBtn">ğŸ¤ Ø³Ø¬Ù„ Ú¤ÙˆÙŠØ³</button>
  <button class="btn btn-outline" id="stopBtn" disabled>â¹ Ø¥ÙŠÙ‚Ø§Ù</button>
  <div id="status"></div>

  <h3>ğŸ¶ Ø§Ù„ØªØ±Ø§ÙƒØ§Øª</h3>
  <div id="tracksContainer"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://esdsowghlkzvhtciptzw.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzZHNvd2dobGt6dmh0Y2lwdHp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3OTUyMDcsImV4cCI6MjA3NDM3MTIwN30.UbcxM3aPtxNclA5G865eFQrKbqR7JaR6vWfoc68INic";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const pinOverlay = document.getElementById("pinOverlay");
  <script>
(function(){
  const PIN = '10326';

  function bindPinAndEnter() {
    const pinOverlay = document.getElementById('pinOverlay');
    const pinInput = document.getElementById('pinInput');
    const pinSubmit = document.getElementById('pinSubmit');
    const pinError = document.getElementById('pinError');
    const enterBtn = document.getElementById('enterBtn') || document.getElementById('enterSiteBtn') || document.getElementById('msgBtn') || document.querySelector('.enter-btn');
    const messageOverlay = document.getElementById('messageOverlay') || document.getElementById('msgOverlay') || document.getElementById('welcomeOverlay');

    if(!pinOverlay || !pinInput || !pinSubmit){
      setTimeout(bindPinAndEnter, 150);
      return;
    }

    pinSubmit.addEventListener('click', function(){
      if(pinInput.value.trim() === PIN){
        if(pinError) pinError.style.display = 'none';
        pinOverlay.style.display = 'none';
        if(messageOverlay) messageOverlay.style.display = 'flex';
      } else {
        if(pinError) pinError.style.display = 'block';
      }
    });

    pinInput.addEventListener('keydown', function(e){
      if(e.key === 'Enter') pinSubmit.click();
    });

    if(enterBtn){
      enterBtn.addEventListener('click', function(){
        if(messageOverlay) messageOverlay.style.display = 'none';
        if(typeof loadTracks === 'function'){ loadTracks(); }
      });
    }
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', bindPinAndEnter);
  } else {
    bindPinAndEnter();
  }
})();
</script>

const pinInput = document.getElementById("pinInput");
const pinSubmit = document.getElementById("pinSubmit");
const pinError = document.getElementById("pinError");
const messageOverlay = document.getElementById("messageOverlay");
const enterBtn = document.getElementById("enterBtn");
const tracksContainer = document.getElementById("tracksContainer");
const fileInput = document.getElementById("fileInput");
const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");
const statusDiv = document.getElementById("status");

const PIN = "10326";
let mediaRecorder, chunks=[];

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù€ PIN
pinSubmit.addEventListener("click", ()=>{
  if(pinInput.value.trim()===PIN){
    pinOverlay.style.display="none";
    messageOverlay.style.display="flex";
  } else {
    pinError.style.display="block";
  }
});
enterBtn.addEventListener("click", ()=> messageOverlay.style.display="none");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ±Ø§ÙƒØ§Øª
async function loadTracks(){
  tracksContainer.innerHTML="";
  let { data, error } = await supabase.from("tracks").select("*").order("id",{ascending:false});
  if(error){ console.error(error); return }
  data.forEach(track=>{
    const div=document.createElement("div");
    div.className="track";
    const box=document.createElement("div");
    box.className="green-box"+(track.selected?" selected":"");
    box.textContent=track.selected?"âœ“":"";
    box.addEventListener("click", async ()=>{
      let { error } = await supabase.from("tracks").update({selected:!track.selected}).eq("id",track.id);
      if(!error){ loadTracks() }
    });
    const info=document.createElement("div");
    info.innerHTML=`<b>${track.file_name}</b><br><audio controls src="${track.file_url}"></audio>
      <a href="${track.file_url}" download>â¬‡ï¸ Ù†Ø²Ù„Ù†ÙŠ</a>`;
    div.appendChild(box);
    div.appendChild(info);
    tracksContainer.appendChild(div);
  });
}

// Ø±ÙØ¹ Ù…Ù„Ù
async function uploadTrack(file){
  const path=Date.now()+"_"+file.name;
  let { error:uploadError } = await supabase.storage.from("tracks").upload(path,file);
  if(uploadError){ alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹"); return }
  let { data } = supabase.storage.from("tracks").getPublicUrl(path);
  await supabase.from("tracks").insert([{file_name:file.name,file_url:data.publicUrl,selected:false}]);
  loadTracks();
}
fileInput.addEventListener("change", e=>{
  if(e.target.files[0]) uploadTrack(e.target.files[0]);
});

// ØªØ³Ø¬ÙŠÙ„ ÙÙˆÙŠØ³
recordBtn.addEventListener("click", async ()=>{
  let stream=await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder=new MediaRecorder(stream);
  chunks=[];
  mediaRecorder.ondataavailable=e=>chunks.push(e.data);
  mediaRecorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"audio/webm"});
    const file=new File([blob],"voice.webm",{type:"audio/webm"});
    uploadTrack(file);
    statusDiv.textContent="";
  };
  mediaRecorder.start();
  recordBtn.disabled=true; stopBtn.disabled=false;
  statusDiv.textContent="â— Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
});
stopBtn.addEventListener("click", ()=>{
  mediaRecorder.stop();
  recordBtn.disabled=false; stopBtn.disabled=true;
});
loadTracks();
</script>
</body>
</html>

