<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ابعتها لمهجة</title>
  <style>
    :root{
      --blue:#0b66ff;
      --light:#f6fbff;
      --green:#25c26b;
      --card-shadow: 0 6px 18px rgba(11,102,255,0.08);
    }
    html,body{
      height:100%;
      margin:0;
      font-family:Arial, "Noto Naskh Arabic", sans-serif;
      background:var(--light);
      color:#0b2447;
    }
    header{
      background:linear-gradient(90deg,white 0%, #eaf3ff 100%);
      border-bottom:1px solid rgba(11,102,255,0.06);
      padding:20px 24px;
      text-align:center;
    }
    .logo{
      width:70px;
      height:70px;
      margin:0 auto 10px auto;
      border-radius:50%;
      background:var(--blue);
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:700;
      font-size:26px;
      box-shadow:var(--card-shadow);
    }
    .subtitle{
      font-family:"Comic Sans MS", cursive, sans-serif;
      font-size:20px;
      color:#205aa8;
      margin-top:6px;
    }
    main{padding:20px;max-width:960px;margin:0 auto}
    .card{background:white;border-radius:14px;padding:18px;box-shadow:var(--card-shadow);margin-bottom:18px}
    .controls{display:flex;gap:12px;flex-wrap:wrap}
    .btn{border:0;padding:12px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--blue);color:white}
    .btn-outline{background:transparent;border:1px solid rgba(11,102,255,0.12);color:var(--blue)}
    #recordBtn.recording{background:#ff5252}
    #recordStatus{font-weight:700;margin-right:6px}
    .dropzone{margin-top:14px;border:2px dashed rgba(11,102,255,0.12);padding:18px;border-radius:12px;text-align:center;color:#1f4f9a}
    input[type=file]{display:none}
    .list{margin-top:16px}
    .track{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(11,102,255,0.04)}
    .track + .track{margin-top:10px}
    .track-info{flex:1}
    .track-title{font-weight:700}
    .track-meta{font-size:12px;color:#6a86b2}
    .green-box{width:44px;height:44px;border-radius:8px;background:white;border:2px solid #ccc;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
    .green-box.active{background:var(--green);color:white;border:2px solid var(--green)}
    .download-btn{padding:6px 10px;background:var(--blue);color:white;border-radius:8px;font-size:14px;text-decoration:none}
    footer{max-width:980px;margin:10px auto;color:#4b6fa3;text-align:center;font-size:13px}
    /* PIN overlay */
    .pin-overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(11,102,255,0.07),rgba(11,102,255,0.12));display:flex;align-items:center;justify-content:center;z-index:9999}
    .pin-box{background:white;padding:26px;border-radius:12px;box-shadow:0 16px 40px rgba(11,102,255,0.12);max-width:420px;width:94%;text-align:center}
    .pin-box h2{margin:0 0 8px 0}
    .pin-box p{margin:0 0 18px 0;color:#2b5aa8}
    .pin-input{font-size:20px;padding:12px;border-radius:10px;border:1px solid #e6eefc;width:100%;box-sizing:border-box;text-align:center}
    .pin-submit{margin-top:12px;padding:10px 14px;border-radius:10px;border:0;background:var(--blue);color:white;font-weight:700;cursor:pointer}
    .pin-error{color:#c0392b;margin-top:10px;display:none}
  </style>
</head>
<body>
  <!-- PIN -->
  <div class="pin-overlay" id="pinOverlay" aria-hidden="false">
    <div class="pin-box">
      <h2>هاي تامر 😂❤️</h2>
      <p>اكتب الكود هنا يا تامر</p>
      <input id="pinInput" class="pin-input" inputmode="numeric" maxlength="6" placeholder="PIN" />
      <button id="pinSubmit" class="pin-submit">يلا أوبح</button>
      <div id="pinError" class="pin-error">الكود مش صح، جرّب تاني.</div>
    </div>
  </div>

  <header>
    <div class="logo">M</div>
    <div class="subtitle">ابعتها لمهجة</div>
  </header>

  <main>
    <section class="card">
      <h3>حمل أغنية أو ابعت ڤويس نوت</h3>
      <div class="controls">
        <label class="btn btn-outline" for="fileInput">رفع ملف صوتي</label>
        <input id="fileInput" type="file" accept="audio/*">
        <button id="recordBtn" class="btn btn-primary">سجل ڤويس نوت</button>
        <button id="stopBtn" class="btn btn-outline" disabled>إيقاف</button>
        <div id="recordStatus"></div>
      </div>
      <div class="dropzone" id="dropzone">اسحب أو اضغط "رفع ملف صوتي"</div>
      <div class="list card" id="tracksList" style="margin-top:18px">
        <h4 style="margin-top:0">قائمة التسجيلات</h4>
        <div id="tracksContainer"></div>
      </div>
    </section>
  </main>

  <footer>تم بناء النموذج الأولي لـ <strong>ابعتها لمهجة</strong></footer>

  <script>
    /* PIN logic */
    (function(){
      const PIN = '10326';
      const overlay = document.getElementById('pinOverlay');
      const input = document.getElementById('pinInput');
      const submit = document.getElementById('pinSubmit');
      const error = document.getElementById('pinError');

      function unlock(){
        overlay.style.display = 'none';
        overlay.setAttribute('aria-hidden','true');
      }

      submit.addEventListener('click', ()=>{
        const val = input.value.trim();
        if(val === PIN) unlock(); else { error.style.display='block'; }
      });
      input.addEventListener('keydown',(e)=>{if(e.key==='Enter') submit.click();});
    })();

    const fileInput=document.getElementById('fileInput');
    const dropzone=document.getElementById('dropzone');
    const tracksContainer=document.getElementById('tracksContainer');
    const recordBtn=document.getElementById('recordBtn');
    const stopBtn=document.getElementById('stopBtn');
    const recordStatus=document.getElementById('recordStatus');

    let mediaRecorder=null; let chunks=[];

    function addTrack(blob,name){
      const url=URL.createObjectURL(blob);
      const track=document.createElement('div');
      track.className='track';

      const greenBox=document.createElement('div');
      greenBox.className='green-box';
      greenBox.innerHTML='✓';
      greenBox.addEventListener('click',()=>{
        greenBox.classList.toggle('active');
      });

      const info=document.createElement('div');
      info.className='track-info';
      const title=document.createElement('div');
      title.className='track-title';
      title.textContent=name||'تسجيل جديد';
      const meta=document.createElement('div');
      meta.className='track-meta';
      const audio=document.createElement('audio');
      audio.controls=true;
      audio.src=url;
      const download=document.createElement('a');
      download.href=url;
      download.download=name||'track';
      download.className='download-btn';
      download.textContent='⬇️ نزلني';
      meta.appendChild(audio);
      meta.appendChild(download);

      info.appendChild(title);
      info.appendChild(meta);

      track.appendChild(greenBox);
      track.appendChild(info);
      tracksContainer.prepend(track);
    }

    fileInput.addEventListener('change',(e)=>{
      const f=e.target.files[0];
      if(!f) return;
      addTrack(f,f.name);
      fileInput.value='';
    });

    ['dragenter','dragover'].forEach(ev=>{
      dropzone.addEventListener(ev,(e)=>{e.preventDefault();dropzone.style.borderColor='rgba(11,102,255,0.4)'});
    });
    ['dragleave','drop'].forEach(ev=>{
      dropzone.addEventListener(ev,(e)=>{e.preventDefault();dropzone.style.borderColor='rgba(11,102,255,0.12)'});
    });
    dropzone.addEventListener('drop',(e)=>{
      const f=e.dataTransfer.files[0];
      if(f) addTrack(f,f.name);
    });

    recordBtn.addEventListener('click',async ()=>{
      if(mediaRecorder&&mediaRecorder.state==='recording') return;
      try{
        const stream=await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder=new MediaRecorder(stream);
        chunks=[];
        mediaRecorder.ondataavailable=e=>chunks.push(e.data);
        mediaRecorder.onstart=()=>{
          recordBtn.classList.add('recording');
          recordBtn.textContent='جاري التسجيل...';
          stopBtn.disabled=false;
          recordStatus.textContent='● تسجيل';
        }
        mediaRecorder.onstop=()=>{
          recordBtn.classList.remove('recording');
          recordBtn.textContent='سجل ڤويس نوت';
          stopBtn.disabled=true;
          recordStatus.textContent='';
          const blob=new Blob(chunks,{type:'audio/webm'});
          addTrack(blob,'ڤويس نوت - '+new Date().toLocaleString());
        }
        mediaRecorder.start();
      }catch(err){
        alert('مش قادر ياخد إذن الميكروفون.');
      }
    });

    stopBtn.addEventListener('click',()=>{
      if(mediaRecorder&&mediaRecorder.state==='recording') mediaRecorder.stop();
    });
  </script>
</body>
</html>